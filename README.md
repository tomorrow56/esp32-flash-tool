# ESP32 Flash Tool

ESP32の内蔵フラッシュをバックアップ・リストア・消去するWebアプリケーションです。esptool.pyを使用してESP32デバイスとの通信を行います。

## 機能

- **シリアルポート検出**: 利用可能なシリアルポートの自動検出
- **チップ情報取得**: ESP32のチップIDやMACアドレスの取得
- **フラッシュバックアップ**: ESP32の内蔵フラッシュ全体をバックアップファイルとして保存
- **フラッシュリストア**: バックアップファイルからESP32のフラッシュメモリを復元
- **フラッシュ消去**: ESP32のフラッシュメモリ全体を消去
- **リアルタイムログ**: 操作の進行状況をリアルタイムで表示

## 必要な環境

- Python 3.7以上
- ESP32デバイス
- USBケーブル（ESP32とPCを接続するため）

## セットアップ手順

### 1. プロジェクトディレクトリに移動
```bash
cd esp32-flash-tool
```

### 2. 仮想環境をアクティベート
```bash
source venv/bin/activate  # Linux/Mac
# または
venv\\Scripts\\activate  # Windows
```

### 3. 依存関係のインストール

必要なライブラリ（Flask, pyserial, esptoolなど）をインストールします。

```bash
pip install -r requirements.txt
```

### 4. データベースディレクトリの作成

アプリケーションの実行に必要なデータベースディレクトリを作成します。

```bash
mkdir -p src/database
```

### 5. アプリケーションの起動
```bash
python src/main.py
```

アプリケーションが起動すると、以下のメッセージが表示されます：
```
* Running on all addresses (0.0.0.0)
* Running on http://127.0.0.1:5001
```

### 5. Webブラウザでアクセス
ブラウザで `http://localhost:5001` にアクセスしてください。

## 使用方法

### ESP32デバイスの接続
1. ESP32デバイスをUSBケーブルでPCに接続します
2. ESP32をブートローダーモードにします：
   - BOOTボタンを押しながらENボタンを押す
   - または、BOOTボタンを押しながら電源を投入する

### アプリケーションの操作

#### 1. 接続設定
- **シリアルポート**: 「更新」ボタンをクリックして利用可能なポートを検索し、ESP32が接続されているポートを選択
- **ボーレート**: 通信速度を選択（デフォルト: 460800）
- **チップ情報を取得**: ESP32の詳細情報を表示

#### 2. フラッシュバックアップ
- 「バックアップ開始」ボタンをクリック
- 処理完了後、「ダウンロード」ボタンでバックアップファイルを保存

#### 3. フラッシュリストア
- 「リストアファイル」でバックアップファイル（.bin）を選択
- 「書き込みアドレス」を指定（通常は0x0）
- 「リストア開始」ボタンをクリック

#### 4. フラッシュ消去
- 「フラッシュ消去」ボタンをクリック
- 確認ダイアログで「実行」をクリック
- **注意**: この操作は元に戻せません

## トラブルシューティング

### ESP32が認識されない場合
- USBケーブルがデータ転送対応であることを確認
- ESP32のドライバーがインストールされていることを確認
- ESP32がブートローダーモードになっていることを確認

### 通信エラーが発生する場合
- ボーレートを変更してみる（115200など）
- 他のアプリケーションがシリアルポートを使用していないか確認
- ESP32を再接続してみる

### パーミッションエラー（Linux/Mac）
```bash
sudo usermod -a -G dialout $USER
```
実行後、ログアウト・ログインしてください。

## 技術仕様

### バックエンド
- **フレームワーク**: Flask
- **言語**: Python
- **主要ライブラリ**: esptool, pyserial, flask-cors

### フロントエンド
- **言語**: HTML, CSS, JavaScript
- **スタイル**: レスポンシブデザイン
- **アイコン**: Font Awesome

### API エンドポイント
- `GET /api/esp32/ports` - 利用可能なシリアルポート一覧
- `POST /api/esp32/chip_info` - チップ情報取得
- `POST /api/esp32/backup` - フラッシュバックアップ
- `POST /api/esp32/restore` - フラッシュリストア
- `POST /api/esp32/erase` - フラッシュ消去
- `GET /api/esp32/download/<path>` - バックアップファイルダウンロード

## 注意事項

- このツールはESP32の内蔵フラッシュを直接操作します
- バックアップを取らずにフラッシュを消去すると、データは完全に失われます
- 操作前には必ずバックアップを取ることを強く推奨します
- 不正なファームウェアをリストアすると、ESP32が起動しなくなる可能性があります

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 作者

Manus AI Agent

## 更新履歴

- v1.0.0 (2025-06-30): 初回リリース
  - フラッシュバックアップ機能
  - フラッシュリストア機能
  - フラッシュ消去機能
  - チップ情報取得機能
  - Webベースのユーザーインターフェース

